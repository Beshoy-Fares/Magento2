<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
declare(strict_types=1);

use Magento\Catalog\Helper\Product;
use Magento\ConfigurableProduct\Block\Adminhtml\Product\Composite\Fieldset\Configurable;
use Magento\Framework\Escaper;
use Magento\Framework\View\Helper\SecureHtmlRenderer;

/** @var Escaper $escaper */
/** @var SecureHtmlRenderer $secureRenderer */
/** @var Configurable $block */
$_product = $block->getProduct();
$_attributes = $block->decorateArray($block->getAllowAttributes());

/** @var Product $productHelper */
$productHelper = $block->getData('productHelper');
$_skipSaleableCheck = $productHelper->getSkipSaleableCheck();
?>
<?php if (($_product->isSaleable() || $_skipSaleableCheck) && count($_attributes)):?>
<fieldset id="catalog_product_composite_configure_fields_configurable" class="fieldset admin__fieldset">
    <legend class="legend admin__legend">
        <span><?= $escaper->escapeHtml(__('Associated Products')) ?></span>
    </legend>
    <div class="product-options fieldset admin__fieldset">
        <?php foreach ($_attributes as $_attribute): ?>
            <div class="field admin__field required">
                <label class="label admin__field-label"><?=
                    $escaper->escapeHtml($_attribute->getProductAttribute()->getStoreLabel($_product->getStoreId()));
                ?></label>
                <div class="control admin__field-control <?php
                if ($_attribute->getDecoratedIsLast()):
                    ?> last<?php
                    endif; ?>">
                    <select name="super_attribute[<?= $escaper->escapeHtmlAttr($_attribute->getAttributeId()) ?>]"
                            id="attribute<?= $escaper->escapeHtmlAttr($_attribute->getAttributeId()) ?>"
                            class="admin__control-select required-entry super-attribute-select">
                        <option><?= $escaper->escapeHtml(__('Choose an Option...')) ?></option>
                    </select>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
</fieldset>
    <?php $config = /* @noEscape */ $block->getJsonConfig();
    $scriptString = <<<script
require([
    "Magento_ConfigurableProduct/js/configurable",
    "Magento_Catalog/catalog/product/composite/configure"
], function(){

    var config = {$config};
    if (window.productConfigure) {
        config.containerId = window.productConfigure.blockFormFields.id;
        if (window.productConfigure.restorePhase) {
            config.inputsInitialized = true;
        }
    }

    ProductConfigure.spConfig = new Product.Config(config);

});
script;
    ?>
    <?= /* @noEscape */ $secureRenderer->renderTag('script', [], $scriptString, false) ?>
<?php endif;?>
