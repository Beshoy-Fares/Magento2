<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
declare(strict_types=1);

use Magento\Backend\Block\Widget\Form\Renderer\Fieldset;
use Magento\Framework\Escaper;
use Magento\Framework\Json\Helper\Data;
use Magento\Framework\View\Helper\SecureHtmlRenderer;

/** @var Escaper $escaper */
/** @var SecureHtmlRenderer $secureRenderer */
/** @var Fieldset $block */
/** @var Data $jsonHelper */
$jsonHelper = $block->getData('jsonHelper');

// phpcs:disable PHPCompatibility.Miscellaneous.RemovedAlternativePHPTags.MaybeASPOpenTagFound
?>
<div id="js-file-uploader" class="uploader">
</div>
<script id="js-file-uploader-template" type="text/x-magento-template">
    <div id="<%- data.id %>" class="file-row">
        <span class="file-info"><%- data.name %> (<%- data.size %>)</span>
        <div class="progressbar-container">
            <div class="progressbar upload-progress""></div>
        </div>
        <?= /* @noEscape */ $secureRenderer->renderStyleAsTag(
            "width: 0%;",
            "div.progressbar-container div.progressbar.upload-progress"
        ) ?>
        <div class="clear"></div>
    </div>
</script>
<script id="js-uploaded-file-template" type="text/x-magento-template">
    <input class="up" type="button" value="">
    <input class="down" type="button" value="">
    <input type="hidden" name="js_order[<%- data.id %>]" value="1">

    <div class="js-file">
        <%- data.name %>
        <div class="remove-js">
            <input
                type="checkbox"
                id="remove_js_files_<%- data.id %>"
                name="js_removed_files[]"
                value="<%- data.id %>" />
            <label for="remove_js_files_<%- data.id %>"><?= $escaper->escapeHtml(__('Remove')) ?></label>
        </div>
    </div>

    <input type="hidden" name="js_uploaded_files[]" value="<%- data.temporary %>" />
</script>

<ul id="js-files-container" class="js-files-container ui-sortable" ></ul>
<?php $scriptString = <<<script

require([
    "jquery",
    "jquery/ui",
    "Magento_Theme/js/sortable",
    "Magento_Theme/js/custom-js-list"
], function(jQuery){

jQuery(function($) {
    $('.ui-sortable').sortable();
    $('.ui-sortable').disableSelection();

    $('#js-files-container').themeJsList({
        templateId : '#js-uploaded-file-template',
        refreshFileListEvent : 'refreshJsList',
        prefixItemId : 'js-file-'
    });
    $('body').trigger(
        'refreshJsList',
        {
            jsList: {$jsonHelper->jsonEncode($block->getJsFiles())}
        }
    );
});

});

script;
?>
<?= /* @noEscape */ $secureRenderer->renderTag('script', [], $scriptString, false) ?>
