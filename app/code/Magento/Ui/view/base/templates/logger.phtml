<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
declare(strict_types=1);

use Magento\Framework\Escaper;
use Magento\Framework\View\Helper\SecureHtmlRenderer;
use Magento\Ui\Block\Logger;

/** @var Escaper $escaper */
/** @var Logger $block */
/** @var SecureHtmlRenderer $secureRenderer */
?>
<?php if ($block->isLoggingEnabled()): ?>
    <?php $scriptString = <<<script

        window.onerror = function(msg, url, line) {
            var key = "{$escaper->escapeJs($block->getSessionStorageKey())}";
            var errors = {};
            if (sessionStorage.getItem(key)) {
                errors = JSON.parse(sessionStorage.getItem(key));
            }
            if (!(window.location.href in errors)) {
                errors[window.location.href] = [];
            }
            errors[window.location.href].push("error: \'" + msg + "\' " + "file: " + url + " " + "line: " + line);
            sessionStorage.setItem(key, JSON.stringify(errors));
        };
script;
    ?>
    <?= /* @noEscape */ $secureRenderer->renderTag('script', [], $scriptString, false) ?>
<?php endif; ?>
