<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="StorefrontCustomerOrderDetailsPagerTest">
        <annotations>
            <stories value="Storefront order pager"/>
            <title value="Pager displays order products at customer account order details page correctly"/>
            <description value="Pager displays correct quantity for different types of products"/>
            <severity value="MAJOR"/>
            <testCaseId value="MC-36553"/>
            <group value="sales"/>
        </annotations>
        <before>
            <!-- Create category -->
            <createData entity="_defaultCategory" stepKey="createCategory"/>
            <!-- Create 20 simple products -->
            <createData entity="SimpleProduct" stepKey="createProduct01">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="SimpleProduct" stepKey="createProduct02">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="SimpleProduct" stepKey="createProduct03">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="SimpleProduct" stepKey="createProduct04">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="createProduct05">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="createProduct06">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="createProduct07">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="createProduct08">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="createProduct09">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="SimpleProduct" stepKey="createProduct10">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="SimpleProduct" stepKey="createProduct11">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="SimpleProduct" stepKey="createProduct12">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct13">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct14">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct15">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct16">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct17">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct18">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct19">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="ApiSimpleProduct" stepKey="createProduct20">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <!-- Create configurable product -->
            <createData entity="ApiConfigurableProduct" stepKey="createConfigProduct">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="productAttributeWithTwoOptions" stepKey="createConfigProductAttribute"/>
            <createData entity="productAttributeOption1" stepKey="createConfigProductAttributeFirstOption">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <createData entity="productAttributeOption2" stepKey="createConfigProductAttributeSecondOption">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <createData entity="AddToDefaultSet" stepKey="createConfigAddToAttributeSet">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </createData>
            <getData entity="ProductAttributeOptionGetter" index="1" stepKey="getConfigAttributeFirstOption">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </getData>
            <getData entity="ProductAttributeOptionGetter" index="2" stepKey="getConfigAttributeSecondOption">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
            </getData>
            <!-- Create simples for configurable product -->
            <createData entity="ApiSimpleOne" stepKey="createConfigFirstChildProduct">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
                <requiredEntity createDataKey="getConfigAttributeFirstOption"/>
            </createData>
            <createData entity="ApiSimpleTwo" stepKey="createConfigSecondChildProduct">
                <requiredEntity createDataKey="createConfigProductAttribute"/>
                <requiredEntity createDataKey="getConfigAttributeSecondOption"/>
            </createData>
            <createData entity="ConfigurableProductTwoOptions" stepKey="createConfigProductOption">
                <requiredEntity createDataKey="createConfigProduct"/>
                <requiredEntity createDataKey="createConfigProductAttribute"/>
                <requiredEntity createDataKey="getConfigAttributeFirstOption"/>
                <requiredEntity createDataKey="getConfigAttributeSecondOption"/>
            </createData>
            <createData entity="ConfigurableProductAddChild" stepKey="createConfigProductAddFirstChild">
                <requiredEntity createDataKey="createConfigProduct"/>
                <requiredEntity createDataKey="createConfigFirstChildProduct"/>
            </createData>
            <createData entity="ConfigurableProductAddChild" stepKey="createConfigProductAddSecondChild">
                <requiredEntity createDataKey="createConfigProduct"/>
                <requiredEntity createDataKey="createConfigSecondChildProduct"/>
            </createData>
            <!-- Create simples for Bundle Product -->
            <createData entity="SimpleProduct2" stepKey="simpleProduct1">
                <field key="price">100.00</field>
            </createData>
            <createData entity="SimpleProduct2" stepKey="simpleProduct2">
                <field key="price">200.00</field>
            </createData>
            <!--Create Bundle product with multi select option-->
            <createData entity="BundleProductPriceViewRange" stepKey="createBundleProduct">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="DropDownBundleOption" stepKey="bundleOption">
                <requiredEntity createDataKey="createBundleProduct"/>
            </createData>
            <createData entity="ApiBundleLink" stepKey="linkOptionToProduct">
                <requiredEntity createDataKey="createBundleProduct"/>
                <requiredEntity createDataKey="bundleOption"/>
                <requiredEntity createDataKey="simpleProduct1"/>
            </createData>
            <createData entity="ApiBundleLink" stepKey="linkOptionToProduct2">
                <requiredEntity createDataKey="createBundleProduct"/>
                <requiredEntity createDataKey="bundleOption"/>
                <requiredEntity createDataKey="simpleProduct2"/>
            </createData>
            <!-- Create customer -->
            <createData entity="Simple_US_Customer" stepKey="createCustomer"/>
            <!-- Reindex and flush the cache to display products on the category page -->
            <actionGroup ref="CliIndexerReindexActionGroup" stepKey="reindex">
                <argument name="indices" value=""/>
            </actionGroup>
            <actionGroup ref="CliCacheFlushActionGroup" stepKey="flushCache">
                <argument name="tags" value=""/>
            </actionGroup>
        </before>
        <after>
            <actionGroup ref="AdminLoginActionGroup" stepKey="LoginAsAdmin"/>
            <!-- Delete category and created products -->
            <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>
            <actionGroup ref="DeleteAllProductsUsingProductGridActionGroup" stepKey="deleteAllProducts"/>
            <deleteData createDataKey="createConfigProductAttribute" stepKey="deleteConfigProductAttribute"/>
            <!-- Delete Customer -->
            <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
            <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
        </after>
        <!-- Login to Storefront as Customer -->
        <actionGroup ref="LoginToStorefrontActionGroup" stepKey="loginAsCustomer">
            <argument name="Customer" value="$$createCustomer$$" />
        </actionGroup>
        <!-- Add 22 products to the cart -->
        <!-- 20 simples -->
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct1">
            <argument name="product" value="$$createProduct01$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct2">
            <argument name="product" value="$$createProduct02$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct3">
            <argument name="product" value="$$createProduct03$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct4">
            <argument name="product" value="$$createProduct04$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct5">
            <argument name="product" value="$$createProduct05$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct6">
            <argument name="product" value="$$createProduct06$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct7">
            <argument name="product" value="$$createProduct07$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct8">
            <argument name="product" value="$$createProduct08$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct9">
            <argument name="product" value="$$createProduct09$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct10">
            <argument name="product" value="$$createProduct10$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct11">
            <argument name="product" value="$$createProduct11$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct12">
            <argument name="product" value="$$createProduct12$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct13">
            <argument name="product" value="$$createProduct13$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct14">
            <argument name="product" value="$$createProduct14$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct15">
            <argument name="product" value="$$createProduct15$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct16">
            <argument name="product" value="$$createProduct16$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct17">
            <argument name="product" value="$$createProduct17$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct18">
            <argument name="product" value="$$createProduct18$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct19">
            <argument name="product" value="$$createProduct19$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddSimpleProductToShoppingCartActionGroup" stepKey="addProduct20">
            <argument name="product" value="$$createProduct20$$"/>
        </actionGroup>
        <!-- 1 configurable -->
        <actionGroup ref="StorefrontAddConfigurableProductToTheCartActionGroup" stepKey="addConfigurableToCart">
            <argument name="urlKey" value="$createConfigProduct.custom_attributes[url_key]$"/>
            <argument name="productAttribute" value="$$createConfigProductAttribute.default_value$$"/>
            <argument name="productOption" value="$$getConfigAttributeSecondOption.label$$"/>
            <argument name="qty" value="1"/>
        </actionGroup>
        <!-- 1 bundle -->
        <actionGroup ref="StorefrontOpenProductPageActionGroup" stepKey="openBundleProduct">
            <argument name="productUrl" value="$$createBundleProduct.custom_attributes[url_key]$$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddBundleProductToTheCartActionGroup" stepKey="addBundleProductToCart">
            <argument name="productName" value="$simpleProduct2.name$"/>
            <argument name="quantity" value="1"/>
        </actionGroup>
        <!-- Place the order -->
        <actionGroup ref="StorefrontOpenCheckoutPageActionGroup" stepKey="onCheckout"/>
        <see userInput="22" selector="{{CheckoutOrderSummarySection.itemsQtyInCart}}" stepKey="see21Products"/>
        <actionGroup ref="StorefrontCheckoutClickNextOnShippingStepActionGroup" stepKey="clickNextButton"/>
        <click selector="{{CheckoutPaymentSection.placeOrder}}" stepKey="placeOrder"/>
        <waitForPageLoad stepKey="waitForSuccess"/>
        <grabTextFrom selector="{{CheckoutSuccessMainSection.orderNumber22}}" stepKey="grabOrderNumber"/>
        <!-- Go to My Account > My Orders page -->
        <actionGroup ref="StorefrontOpenMyAccountPageActionGroup" stepKey="onMyAccount"/>
        <click selector="{{StorefrontCustomerSidebarSection.sidebarTab('My Orders')}}" stepKey="clickOnMyOrders"/>
        <waitForPageLoad stepKey="waitForOrdersLoad"/>
        <!-- Click 'View Order' link on order from preconditions -->
        <actionGroup ref="StorefrontCustomerOrdersViewOrderActionGroup" stepKey="clickOrderView">
            <argument name="orderNumber" value="{$grabOrderNumber}"/>
        </actionGroup>
        <!-- Assert that Pager displays 20 order items correctly -->
        <grabTextFrom selector="{{StorefrontCustomerOrderViewSection.pager}}" stepKey="productsCount"/>
        <assertStringContainsString stepKey="assertProductsCount">
            <actualResult type="const">$productsCount</actualResult>
            <expectedResult type="string">Items 1 to 20 of 22 total</expectedResult>
        </assertStringContainsString>
        <!-- Assert that Pager displays 2nd page order items correctly -->
        <click selector="a.action.next" stepKey="clickNextPage"/>
        <grabTextFrom selector="{{StorefrontCustomerOrderViewSection.productName}}" stepKey="configOptionValue"/>
        <assertStringContainsString stepKey="assertConfigurableChildProduct">
            <actualResult type="variable">configOptionValue</actualResult>
            <expectedResult type="string">$$getConfigAttributeSecondOption.label$$</expectedResult>
        </assertStringContainsString>
        <grabMultiple selector="{{StorefrontCustomerOrderViewSection.productName}}" stepKey="bundleOptionValue"/>
        <assertContains stepKey="assertBundleChildProduct">
            <actualResult type="variable">bundleOptionValue</actualResult>
            <expectedResult type="string">1 x $$simpleProduct2.name$$ $200.00</expectedResult>
        </assertContains>
    </test>
</tests>
