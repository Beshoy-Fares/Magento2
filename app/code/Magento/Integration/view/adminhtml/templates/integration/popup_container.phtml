<?php
/**
 * Popup container template.
 *
 * Copyright Â© 2015 Magento. All rights reserved.
 * See COPYING.txt for license details.
 *
 * @var \Magento\Backend\Block\Template $block
 */
?>
<script>
require([
    "jquery",
    'Magento_Ui/js/modal/modal',
    "jquery/ui",
	"Magento_Integration/js/integration"
], function($, modal){

    window.integration = new Integration(
        '<?php echo $block->getUrl('*/*/permissionsDialog', ['id' => ':id', 'reauthorize' => ':isReauthorize']); ?>',
        '<?php echo $block->getUrl('*/*/tokensDialog', ['id' => ':id', 'reauthorize' => ':isReauthorize']); ?>',
        '<?php echo $block->getUrl('*/*/tokensExchange', ['id' => ':id', 'reauthorize' => ':isReauthorize']); ?>',
        '<?php echo $block->getUrl('*/*'); ?>',
        '<?php echo $block->getUrl('*/*/loginSuccessCallback'); ?>'
    );

    /**
     * Confirm dialog for delete integration action
     */
    $(function () {
        $('div#integrationGrid').on('click', 'button#delete', function (e) {
            $('#integration-delete-container').modal({
                type: 'popup',
                buttons: [{
                    text: 'Cancel',
                    class: '',
                    click: function () {
                        this.closeModal();
                    }
                },
                    {
                        text: 'Delete',
                        class: '',
                        click: function (e) {
                            window.location.href = $(e.target).data('url');
                        }
                    }
                ]
            }).trigger('openModal');

            e.stopPropagation();
        });
    });

});
</script>

<div id="integration-popup-container" style="display: none;"></div>
<div id="integration-delete-container"
     class="messages"
     style="display: none;"
     title="<?php echo __('Are you sure ?'); ?>">
    <div class="message message-notice notice">
        <div>
            <?php echo __("Are you sure you want to delete this integration? You can't undo this action."); ?>
        </div>
    </div>
</div>
