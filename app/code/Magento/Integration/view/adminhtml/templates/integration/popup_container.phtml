<?php
/**
 * Popup container template.
 *
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 *
 * @var Template $block
 */
declare(strict_types=1);

use Magento\Backend\Block\Template;
use Magento\Framework\Escaper;
use Magento\Framework\View\Helper\SecureHtmlRenderer;

/** @var Escaper $escaper */
/** @var Template $block */
/** @var SecureHtmlRenderer $secureRenderer */

$scriptString = <<<script
    require([
        "jquery",
        'Magento_Ui/js/modal/confirm',
        "jquery/ui",
        "Magento_Integration/js/integration",
        'mage/dataPost'
    ], function ($, Confirm) {

        window.integration = new Integration(
            '{$escaper->escapeJs(
                $block->getUrl(
                    '*/*/permissionsDialog',
                    ['id' => ':id', 'reauthorize' => ':isReauthorize', '_escape_params' => false]
                )
            )}',
            '{$escaper->escapeJs(
                $block->getUrl(
                    '*/*/tokensDialog',
                    ['id' => ':id', 'reauthorize' => ':isReauthorize', '_escape_params' => false]
                )
            )}',
            '{$escaper->escapeJs(
                $block->getUrl(
                    '*/*/tokensExchange',
                    ['id' => ':id', 'reauthorize' => ':isReauthorize', '_escape_params' => false]
                )
            )}',
            '{$escaper->escapeJs(
                $block->getUrl(
                    '*/*'
                )
            )}',
            '{$escaper->escapeJs(
                $block->getUrl(
                    '*/*/loginSuccessCallback'
                )
            )}'
        );

        /**
         * Confirm dialog for delete integration action
         */
        $(function () {
            $('div#integrationGrid').on('click', 'button#delete', function (e) {

                new Confirm({
                    title: '{$escaper->escapeJs(__('Are you sure?'))}',
                    content: "{$escaper->escapeJs(__("Are you sure you want to delete this integration? " .
                                                     "You can't undo this action."))}",
                    actions: {
                        confirm: function () {
                            $.mage.dataPost().postData({action: $(e.target).data('url'), data: {}});
                        }
                    }
                });
                e.stopPropagation();
            });
        });
    });
script;
?>
<?= /* @noEscape */ $secureRenderer->renderTag('script', [], $scriptString, false) ?>

<div id="integration-popup-container"></div>
<?= /* @noEscape */ $secureRenderer->renderStyleAsTag("display: none;", '#integration-popup-container') ?>
