<?php
/**
 * Copyright Â© 2015 Magento. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

/**
 * Product media data template
 *
 * @var $block \Magento\Catalog\Block\Product\View\Gallery
 */
?>
<?php
$product = $block->getProduct();
$_hasImage = ($product->getImage() && $product->getImage() != "no_selection") ? true : false;

$imageMain = $block->getImage($product, 'product_page_main_image', ['itemprop' => 'image']);
$imageThumbnail = $block->getImage($product, 'product_page_more_views');
?>

<div class="gallery-placeholder"></div>

<?php $imagesItems = array(); ?>
<?php foreach ($block->getGalleryImages() as $_image): ?>
<?php
        $imageSmall = $block->getImageUrl($_image, 'thumbnail', $whiteBorders, $thumbWidth, $thumbHeight);
$imageMedium = $block->getImageUrl($_image, 'image', $whiteBorders, $_resizedWidth, $_resizedHeight);
$imgCaption = $block->escapeHtml($_image->getLabel());
$imageItem = ('{"img": "' . (string)$imageMedium . '", "thumb": "' . (string)$imageSmall . '", "caption": "' . (string)$imgCaption . '"}');
array_push($imagesItems, $imageItem);
?>
<?php endforeach; ?>
<?php $imagesItemsJson = '[' . implode(',', $imagesItems) . ']'; ?>

<?php
    $nav = $block->getVar("gallery_nav");
    $loop = $block->getVar("gallery_loop");
?>

<script type="text/x-magento-init">
    {
        ".gallery-placeholder": {
            "mage/new-gallery": {
                 "nav": "<?php echo $nav; ?>",
                 "width": "100%",
                 "height": 400,
                 "loop": <?php echo $loop; ?>,
                 "keyboard": true,
                 "allowfullscreen": false,
                 "showCaption": false,
                 "data": <?php echo $imagesItemsJson; ?>
            }
        }
    }
</script>
