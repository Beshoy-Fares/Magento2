<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
?>
<?php
/** @var $block \Magento\Catalog\Block\Product\Image */
/** @var $escaper \Magento\Framework\Escaper */
/** @var \Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer */
$width = (int)$block->getWidth();
$height = (int)$block->getHeight();
$paddingBottom = $block->getRatio() * 100;
?>
<span class="product-image-container product-image-container-<?= /* @noEscape */ $block->getProductId() ?>">
    <img class="<?= $escaper->escapeHtmlAttr($block->getClass()) ?>"
        <?php foreach ($block->getCustomAttributes() as $name => $value): ?>
            <?= $escaper->escapeHtmlAttr($name) ?>="<?= $escaper->escapeHtml($value) ?>"
        <?php endforeach; ?>
        src="<?= $escaper->escapeUrl($block->getImageUrl()) ?>"
        loading="lazy"
        width="<?= $escaper->escapeHtmlAttr($block->getWidth()) ?>"
        height="<?= $escaper->escapeHtmlAttr($block->getHeight()) ?>"
        alt="<?= $escaper->escapeHtmlAttr($block->getLabel()) ?>"/>
</span>
<?php
$styles = <<<STYLE
.product-image-container-{$block->getProductId()} > img {
    width: {$width}px;
    aspect-ratio: auto {$width} / {$height};
    height: {$height}px;
}
// fallback
@supports not (aspect-ratio: auto) {
    .product-image-container {
        position: relative;
    }
    .product-image-container-{$block->getProductId()}::before {
        width:100%;
        content:'';
        padding-bottom:{$paddingBottom}%;
        display: block;
    }
    .product-image-container-{$block->getProductId()} > img.product-image-photo {
        bottom: 0 !important;
        display: block !important;
        left: 0 !important;
        margin: auto !important;
        position: absolute !important;
        right: 0 !important;
        top: 0 !important;
        width: auto !important;
    }
}
.product-image-photo {
    bottom: inherit !important;
    display: inherit !important;
    left: inherit !important;
    margin: inherit !important;
    position: inherit !important;
    right: inherit !important;
    top: inherit !important;
    width: inherit !important;
}
STYLE;
?>
<?= /* @noEscape */ $secureRenderer->renderTag('style', [], $styles, false) ?>
