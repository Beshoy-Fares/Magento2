<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
?>
<?php
/** @var $block \Magento\Catalog\Block\Product\Image */
/** @var $escaper \Magento\Framework\Escaper */
/** @var \Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer */
$width = (int)$block->getWidth();
$height = (int)$block->getHeight();
$paddingBottom = $block->getRatio() * 100;
?>
<span class="product-image-container product-image-container-<?= /* @noEscape */ $block->getProductId() ?>">
    <img class="<?= $escaper->escapeHtmlAttr($block->getClass()) ?>"
        <?php foreach ($block->getCustomAttributes() as $name => $value): ?>
            <?= $escaper->escapeHtmlAttr($name) ?>="<?= $escaper->escapeHtml($value) ?>"
        <?php endforeach; ?>
        src="<?= $escaper->escapeUrl($block->getImageUrl()) ?>"
        loading="lazy"
        width="<?= $escaper->escapeHtmlAttr($block->getWidth()) ?>"
        height="<?= $escaper->escapeHtmlAttr($block->getHeight()) ?>"
        alt="<?= $escaper->escapeHtmlAttr($block->getLabel()) ?>"/>
</span>
<?php
$styles = <<<STYLE
.product-image-container {
    position: relative;
}
.product-image-container-{$block->getProductId()} > img {
    aspect-ratio: auto {$width} / {$height};
    height: auto;
    position: absolute !important;
    top: 0 !important;    
    bottom: 0 !important;
    left: 0 !important;
    margin: auto !important;
    right: 0 !important;
    width: auto !important;
}
.product-image-container-{$block->getProductId()}::before {
    width:100%;
    content:'';
    padding-bottom:{$paddingBottom}%;
    display: block;
}
STYLE;
?>
<?= /* @noEscape */ $secureRenderer->renderTag('style', [], $styles, false) ?>
