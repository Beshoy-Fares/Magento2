<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

/**
 * @var \Magento\Captcha\Block\Captcha\DefaultCaptcha $block
 * @var \Magento\Framework\Escaper $escaper
 */

/** @var \Magento\Captcha\Model\DefaultModel $captcha */
$captcha = $block->getCaptchaModel();

/** @var bool $validationEnabled */
$validationEnabled = $block->hasData('frontend_validation') ? $block->getData('frontend_validation') : true;
$inputName = $escaper->escapeHtmlAttr(\Magento\Captcha\Helper\Data::INPUT_NAME_FIELD_VALUE);
$loaderUrl = $escaper->escapeUrl($block->getViewFileUrl('images/loader-2.gif'));
$note = $escaper->escapeHtml(__('<strong>Attention</strong>: Captcha is case sensitive.'), ['strong']);
?>
<div class="field captcha<?php if ($validationEnabled): ?> required<?php endif; ?>"
     role="<?= $escaper->escapeHtmlAttr($block->getFormId()) ?>">
    <label for="captcha_<?= $escaper->escapeHtmlAttr($block->getFormId()) ?>" class="label">
        <span><?= $escaper->escapeHtml(__('Please type the letters and numbers below')) ?></span>
    </label>
    <div class="control captcha">
        <input
            name="<?= /* @noEscape */ $inputName ?>[<?= $escaper->escapeHtmlAttr($block->getFormId()) ?>]"
            type="text"
            class="input-text<?php if ($validationEnabled): ?> required-entry<?php endif; ?>"
            <?php if ($validationEnabled): ?>data-validate="{required:true}"<?php endif; ?>
            id="captcha_<?= $escaper->escapeHtmlAttr($block->getFormId()) ?>"
            autocomplete="off"/>
        <div class="nested">
            <div class="field captcha no-label"
                 data-captcha="<?= $escaper->escapeHtmlAttr($block->getFormId()) ?>"
                 id="captcha-container-<?= $escaper->escapeHtmlAttr($block->getFormId()) ?>"
                 data-mage-init='{"captcha":{"url": "<?= $escaper->escapeUrl($block->getRefreshUrl()) ?>",
                                            "imageLoader": "<?= /* @noEscape */ $loaderUrl ?>",
                                             "type": "<?= $escaper->escapeHtmlAttr($block->getFormId()) ?>"}}'>
                <div class="control captcha-image">
                    <img alt="<?= $escaper->escapeHtmlAttr(__('Please type the letters and numbers below')) ?>"
                         class="captcha-img"
                         height="<?= /* @noEscape */ (float) $block->getImgHeight() ?>"
                         src="<?= $escaper->escapeUrl($captcha->getImgSrc()) ?>"/>
                    <button type="button"
                            class="action reload captcha-reload"
                            title="<?= $escaper->escapeHtmlAttr(__('Reload captcha')) ?>">
                        <span><?= $escaper->escapeHtml(__('Reload captcha')) ?></span>
                    </button>
                </div>
            </div>
            <?php if ($captcha->isCaseSensitive()):?>
                <div class="captcha-note note"><?= /* @noEscape */ $note ?></div>
            <?php endif; ?>
        </div>
    </div>
</div>
